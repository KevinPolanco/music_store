
<div class="d-flex justify-content-center mt-5">
  
  <div id="app" class="container row row-cols-1 minHeight mt-5">
    <div style="height:200vh"></div>
  </div>
  
</div>
<div class="d-flex justify-content-center" data-aos="fade-up" data-aos-duration="1500">
    <button id="previous" type="button" data-previous="previous" class="btn btn-outline-warning m-2 disabled"><</button>
    <button id="next" type="button" data-next="next" class="btn btn-outline-warning m-2">></button>
</div>

<script>

  let limit = 20;
  let offset = 0;
 
  const writeData = (data) => {
    app.innerHTML = ''
    data.forEach((data) => {
      app.innerHTML += `
        <div class="card border-white w-100 mb-3" data-aos="fade-up" data-aos-duration="1500">
          <div class="row g-0">
            <div class="col-md-4">
              <img src="${data.cover}" class="img-fluid rounded-start" alt="...">
            </div>
            <div class="col-md-4 align-self-center">
              <div class="card-body">
                <h5 class="card-title">${data.name}</h5>
                <p class="card-text"><b>${data.artist}</b></p>
                <p class="card-text"><p><b>Sello:</b>  ${data.label}<br><b>Lanzamineto:</b> ${data.release_year}<br><b>Genero:</b> ${data.genre}</p>
              </div>
            </div>
            <div class="col-md-4 align-self-center">
              <div class="card-body text-end">
                <h2 class="card-title mb-3">$${data.price}</h2>
                <button data-id="${data.id}" class="btn btn-warning btn-lg">Comprar</button>
              </div>
            </div>
          </div>
        </div>
        <div>
          <hr class="mt-md-5 mb-md-5 " data-aos="fade-up" data-aos-duration="1500">
        </div>
      `
    })
  } 

  if(!localStorage.getItem('token')){
    window.location.href= "/login"
  }
  document.addEventListener("DOMContentLoaded", async() => {
    
    try {
      const res = await fetch(`/api/v1/discs?limit=${limit}&offset=${offset}`, {
        headers: {
          Authorization: `Bearer ${localStorage.getItem('token')}`
        }
      })
      const data = await res.json()
      if(!data.ok){
        window.location.href= "login"
      }
      
      writeData(data.discs)
      

      document.addEventListener('click', async(e) => { 
        
        if(e.target.dataset.id){
          const res = await fetch('/api/v1/discs/addDics', {
            method: 'POST',
            headers: {
              Authorization: `Bearer ${localStorage.getItem('token')}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({discs_id : e.target.dataset.id})
          })
          const data = await res.json()
          if(!data.ok){
            window.location.href= "login"
          }
          if(data.ok){
            window.location.href= "/myCollection"
          }
        }

        if(e.target.dataset.next){  
          window.scrollTo(0,0)         
          offset += limit;
          const res = await fetch(`/api/v1/discs?limit=${limit}&offset=${offset}`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem('token')}`
            }
          })
          const data = await res.json()

          if(offset > 0) previous.classList.remove("disabled")
          if(data.discs.length < limit) next.classList.add("disabled")
          if(!data.ok) window.location.href= "login"
          
          writeData(data.discs)
        }

        
        if(e.target.dataset.previous){
          window.scrollTo(0,0)     
          offset -= limit;
          const res = await fetch(`/api/v1/discs?limit=${limit}&offset=${offset}`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem('token')}`
            }
          })
          const data = await res.json()

          if(offset == 0) previous.classList.add("disabled")
          if(data.discs.length == limit) next.classList.remove("disabled")
          if(!data.ok) window.location.href= "login"
          
          writeData(data.discs)
        }
          
      })
    } catch (error){
      console.log(error)
    }
  })
  
</script>
